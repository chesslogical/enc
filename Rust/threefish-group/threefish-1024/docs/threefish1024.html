
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Threefish CLI — Encryption Tool</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 2em auto; line-height: 1.6; }
    pre { background: #f4f4f4; padding: 1em; overflow-x: auto; }
    code { font-family: monospace; }
    h1, h2, h3 { color: #333; }
    .section { margin-bottom: 2em; }
  </style>
</head>
<body>

  <h1>Threefish CLI</h1>
  <p>
    A lightweight command‑line tool to encrypt and decrypt files <strong>in-place</strong> 
    using the Threefish‑1024 block cipher in CTR mode, authenticated by HMAC‑SHA256.
  </p>

  <div class="section">
    <h2>How it works</h2>
    <ol>
      <li><strong>Key file</strong>: <code>key.key</code> (160 bytes):<br>
        • First 128 bytes = Threefish‑1024 key<br>
        • Next 32 bytes  = HMAC‑SHA256 key
      </li>
      <li><strong>Header</strong> (13 bytes):
        <pre>
MAGIC     = "T1FS"      (4 bytes)
VERSION   = 0x01        (1 byte)
NONCE     = u64 LE‑encoded (8 bytes)
        </pre>
      </li>
      <li><strong>Ciphertext</strong>:
        <ul>
          <li>File is read in 128‑byte blocks.</li>
          <li>For block _i_, keystream = Threefish1024<sub>key</sub>(counter=_i_, tweak=(nonce,_i_)).</li>
          <li>Plain⊕keystream → ciphertext.</li>
        </ul>
      </li>
      <li><strong>Authentication</strong>:
        <ul>
          <li>HMAC‑SHA256 is computed over (header ∥ ciphertext).</li>
          <li>32‑byte MAC appended at end.</li>
        </ul>
      </li>
      <li><strong>Safe in‑place update</strong>:
        <ul>
          <li>Writes to a temp file.</li>
          <li>On success, atomically renames it over the original.</li>
        </ul>
      </li>
    </ol>
  </div>

  <div class="section">
    <h2>Installing &amp; Building</h2>
    <pre><code>git clone https://your.repo/threefish_cli.git
cd threefish_cli
cargo build --release</code></pre>
  </div>

  <div class="section">
    <h2>Key Generation</h2>

    <h3>Linux/macOS</h3>
    <pre><code># 128 B Threefish key + 32 B HMAC key = 160 B
dd if=/dev/urandom bs=160 count=1 of=key.key
</code></pre>

    <h3>Windows PowerShell</h3>
    <pre><code># Generate 160 cryptographically‑secure random bytes
[Byte[]] $k = New-Object Byte[] 160
[Security.Cryptography.RandomNumberGenerator]::Create().GetBytes($k)
[IO.File]::WriteAllBytes("key.key", $k)
</code></pre>
  </div>

  <div class="section">
    <h2>Usage</h2>

    <h3>Encrypting a file</h3>
    <pre><code># In‑place encryption (backup manually first if desired)
./target/release/threefish_cli encrypt /path/to/plain.txt
</code></pre>

    <h3>Decrypting a file</h3>
    <pre><code># Verifies HMAC before writing
./target/release/threefish_cli decrypt /path/to/plain.txt
</code></pre>
  </div>

  <div class="section">
    <h2>Example Session</h2>
    <pre><code># 1) Generate key
dd if=/dev/urandom bs=160 count=1 of=key.key

# 2) Create sample
echo "Attack at dawn!" > secret.txt

# 3) Encrypt
./threefish_cli encrypt secret.txt

# (file is now binary)

# 4) Decrypt
./threefish_cli decrypt secret.txt

# secret.txt again contains "Attack at dawn!"
</code></pre>
  </div>

  <div class="section">
    <h2>Algorithm Details</h2>
    <p>
      • <strong>Threefish‑1024</strong> is a tweakable 1024‑bit block cipher; here we use only 128 B of output per block.<br>
      • We treat the cipher as a stream generator: the tweak carries a random nonce and a block counter.  
      • This ensures each block’s keystream is unique even if the same key is reused.  
      • HMAC‑SHA256 authenticates the entire encrypted payload, protecting confidentiality and integrity.
    </p>
  </div>

  <footer>
    <p style="font-size:0.9em;color:#666;">
      &copy; 2025 Threefish CLI • Released under MIT License
    </p>
  </footer>
</body>
</html>
