<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Threefish CLI — Reference</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 2em auto; line-height: 1.6; }
    pre { background: #f4f4f4; padding: 1em; overflow-x: auto; }
    code { font-family: monospace; }
    h1, h2, h3 { color: #333; }
    .section { margin-bottom: 2em; }
  </style>
</head>
<body>

  <h1>Threefish CLI — Encryption Tool Reference</h1>
  <p>A versatile command-line tool offering two modes of operation: <strong>raw key file</strong> (160 B key) and <strong>passphrase</strong> (Argon2id-KDF). Supports Threefish‑1024 in CTR mode plus HMAC‑SHA256.</p>

  <div class="section">
    <h2>Features</h2>
    <ul>
      <li><strong>Dual key modes</strong>: raw keyfile (<code>--keyfile</code>) or passphrase (<code>--password</code>).</li>
      <li><strong>Authenticated encryption</strong>: Threefish‑1024‑CTR + HMAC‑SHA256 (Encrypt‑then‑MAC).</li>
      <li><strong>Streaming & in‑place</strong>: fixed 128 B blocks, temp file → atomic replace (Windows-safe).</li>
      <li><strong>Zeroization</strong>: all key material wiped from memory after use.</li>
      <li><strong>Salt & nonce</strong>: per‑file 16 B salt + 8 B nonce for uniqueness.</li>
    </ul>
  </div>

  <div class="section">
    <h2>Modes of Operation</h2>

    <h3>Raw Key File Mode</h3>
    <p>Supply a 160-byte file (<code>--keyfile key.key</code>) that contains 128 B Threefish key + 32 B HMAC key.</p>

    <h3>Passphrase Mode</h3>
    <p>Invoke <code>--password</code> to be prompted for a passphrase. Internally:
      <ol>
        <li>Generate 16-byte random salt.</li>
        <li>Derive a 160 B key (128 B cipher + 32 B HMAC) via Argon2id(passphrase, salt).</li>
        <li>Embed salt in header for decryption.</li>
      </ol>
    </p>
  </div>

  <div class="section">
    <h2>Header Layout</h2>
    <pre><code>4 B  | "T1FS" (magic)
1 B  | version = 0x01
16 B | salt (passphrase only; zero if raw key)
8 B  | nonce (u64 LE)
—
...  | ciphertext (128 B blocks of Threefish‑CTR)
—
32 B | HMAC‑SHA256 tag
</code></pre>
  </div>

  <div class="section">
    <h2>Examples (secret.txt)</h2>

    <h3>Generate a random key file</h3>
    <pre><code># Linux/macOS:
  dd if=/dev/urandom bs=160 count=1 of=key.key
# Windows PowerShell:
  $k=New-Object Byte[] 160; [Security.Cryptography.RandomNumberGenerator]::Create().GetBytes($k); [IO.File]::WriteAllBytes("key.key", $k)
    </code></pre>

    <h3>Encrypt with raw key</h3>
    <pre><code># In-place using key.key
3f --keyfile key.key encrypt secret.txt
    </code></pre>

    <h3>Decrypt with raw key</h3>
    <pre><code>3f --keyfile key.key decrypt secret.txt
    </code></pre>

    <h3>Encrypt with passphrase</h3>
    <pre><code>3f --password encrypt secret.txt
Enter encryption passphrase: ********
    </code></pre>

    <h3>Decrypt with passphrase</h3>
    <pre><code>3f --password decrypt secret.txt
Enter decryption passphrase: ********
    </code></pre>
  </div>

  <div class="section">
    <h2>Security Discussion</h2>
    <p><strong>Algorithm strength</strong>: Threefish‑1024 uses a 1 024‑bit key/block but its cryptanalytic margin is tuned to ~256‑bit security—the same “effective” level as AES‑256 or ChaCha20.</p>
    <p><strong>Key size vs. passphrase</strong>: Expanding a human passphrase into a larger key does <em>not</em> increase entropy. Your security is limited by the passphrase’s real entropy and the cost per Argon2 guess.</p>
    <p><strong>Brute-force resistance</strong>: A truly random 1 024‑bit key is far out of reach of any attacker (2¹⁰²⁴ possibilities), but when you derive it from a passphrase, the attacker’s workload is “number of passphrase guesses” × “KDF cost,” not the cipher key size.</p>
    <p><strong>Best practices</strong>:
      <ul>
        <li>Use a high-entropy passphrase (e.g. 8+ Diceware words for ~80+ bits).</li>
        <li>Harden Argon2 parameters (memory, iterations) so each guess is expensive.</li>
        <li>Consider adding a stored “pepper” for added offline-attack resistance.</li>
        <li>Use standardized AEAD (AES‑GCM / ChaCha20‑Poly1305) for hardware acceleration and audits, unless Threefish is required.</li>
      </ul>
    </p>
  </div>

  <footer>
    <p style="font-size:0.9em;color:#666;">© 2025 Threefish CLI • MIT License</p>
  </footer>
</body>
</html>
