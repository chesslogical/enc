
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Threefishâ€‘1024 CLI Encryptor / Decryptor â€“ README</title>
<style>
body { font-family: system-ui, sans-serif; line-height: 1.55; margin: 2rem; max-width: 900px; }
h1, h2, h3 { line-height: 1.25; }
pre, code { font-family: ui-monospace, monospace; background: #f4f4f4; padding: 2px 4px; border-radius: 4px; }
pre { padding: 1rem; overflow-x: auto; }
table { border-collapse: collapse; }
th, td { padding: .4rem .6rem; border: 1px solid #ccc; }
kbd { background:#f0f0f0; border-radius:3px; padding:2px 4px; font-family:ui-monospace,monospace; }
</style>
</head>
<body>

<h1>Threefishâ€‘1024Â +Â HMACâ€‘SHAâ€‘256Â Encrypt / Decrypt Tool</h1>

<p>A minimal, fast, <em>authenticated</em> file encryptor written in Rust.
It uses the <strong>Threefishâ€‘1024</strong> block cipher in counterâ€‘mode
together with an <strong>HMACâ€‘SHAâ€‘256</strong> message authentication code
(Encryptâ€‘thenâ€‘MAC construction).</p>

<p>The commandâ€‘line interface is frictionâ€‘free: run the program on any file
and it will <em>automatically</em> decide whether to encrypt or decrypt,
based on a 48â€‘byte header that is prepended to every ciphertext produced by
this tool.</p>

<hr>

<h2>Table of Contents</h2>
<ol>
 <li><a href="#features">Features</a></li>
 <li><a href="#quick-start-linux">Quick&nbsp;start â€“ Linux / macOS</a></li>
 <li><a href="#quick-start-windows">Quick&nbsp;start â€“ Windows</a></li>
 <li><a href="#command-line-options">Commandâ€‘line options</a></li>
 <li><a href="#file-format">File format</a></li>
 <li><a href="#security-notes">Security notes &amp; caveats</a></li>
 <li><a href="#development">Development &amp; testing</a></li>
 <li><a href="#license">License</a></li>
</ol>

<h2 id="features">1.Â Features</h2>
<ul>
 <li>ğŸ”‘Â <strong>Static keyfile</strong>: 160&nbsp;bytes; firstÂ 128â€¯B = cipher key, lastÂ 32â€¯B = MAC key.</li>
 <li>ğŸª¶Â <strong>Zero dependencies at runtime</strong> â€“ linked statically you get a single portable binary (<code>.exe</code> on Windows).</li>
 <li>ğŸ§ Â <strong>Autoâ€‘detect</strong> mode: decrypts when a valid header is present, otherwise encrypts.</li>
 <li>ğŸ’ªÂ <strong>Authenticated</strong>: tampering is detected before any decryption happens.</li>
 <li>ğŸ”„Â <strong>Inâ€‘place</strong> processing with atomic rename (Windowsâ€‘safe).</li>
 <li>ğŸ’»Â <code>--encrypt</code> / <code>--decrypt</code> flags to override detection, plus <code>--quiet</code>.</li>
</ul>

<h2 id="quick-start-linux">2.Â Quick start â€“ Linux / macOS</h2>

<pre><code># 1) Generate a random 160â€‘byte key
$ head -c 160 /dev/urandom &gt; key.key

# 2) Build the tool (requires Rust 1.70+)
$ cargo build --release

# 3) Encrypt a file in place
$ ./target/release/threefish secret.txt
secret.txt â†’ encrypted

# 4) Decrypt it back
$ ./target/release/threefish secret.txt
secret.txt â†’ decrypted
</code></pre>

<h2 id="quick-start-windows">3.Â Quick start â€“ Windows</h2>

<ol>
<li><strong>Install Rust</strong>  
   <ul>
     <li>Download and run <a href="https://win.rustup.rs/">rustupâ€‘init.exe</a>,
         then follow the prompts (the default <kbd>stableâ€‘x86_64â€‘pcâ€‘windowsâ€‘msvc</kbd> toolchain is fine).</li>
   </ul>
</li>
<li><strong>Clone / unzip</strong> the project sources.</li>
<li><strong>Open a â€œDeveloper PowerShellâ€</strong> or plain PowerShell window.</li>
<li><strong>Generate a keyfile</strong> (PowerShell syntax):  
<pre><code>PS&gt; 1..160 | % { [byte](Get-Random -Minimum 0 -Maximum 256) } |
        Set-Content -Encoding Byte -Path .\key.key</code></pre></li>
<li><strong>Build a release binary</strong>:  
<pre><code>PS&gt; cargo build --release
</code></pre></li>
<li>The executable is at  
<pre><code>target\release\threefish.exe</code></pre></li>
<li><strong>Encrypt / decrypt</strong>:  
<pre><code>PS&gt; .\threefish.exe report.pdf
report.pdf â†’ encrypted

PS&gt; .\threefish.exe report.pdf
report.pdf â†’ decrypted
</code></pre></li>
</ol>

<h3>3.1Â Fully static <code>.exe</code> (no MSVC DLLs)</h3>

<p>The easiest path is to crossâ€‘compile with the <kbd>gnu</kbd> toolchain:</p>

<pre><code>PS&gt; rustup toolchain install stable-x86_64-pc-windows-gnu --component rustfmt
PS&gt; rustup target add x86_64-pc-windows-gnu
PS&gt; set RUSTFLAGS=-C target-feature=+crt-static
PS&gt; cargo +stable-x86_64-pc-windows-gnu build --release --target x86_64-pc-windows-gnu
</code></pre>

<p>You will need a MinGWâ€‘w64 linker. An easy option is to install
<a href="https://www.msys2.org/">MSYS2</a> and add its <code>mingw64\bin</code>
folder to <code>PATH</code>. The resulting
<code>target\x86_64-pc-windows-gnu\release\threefish.exe</code> is a
selfâ€‘contained binary that can run on a bare Windows installation.</p>

<p><em>Tip:</em> With the MSVC toolchain you can also embed the CRT
statically (<code>-C target-feature=+crt-static</code>), but static linking
of <code>advapi32</code> etc. is not supported; therefore the GNU toolchain
is recommended for a truly dependencyâ€‘free binary.</p>

<h2 id="command-line-options">4.Â Commandâ€‘line options</h2>

<table>
<thead><tr><th>Flag</th><th>Purpose</th></tr></thead>
<tbody>
<tr><td><code>&lt;FILE&gt;</code></td><td>Path to the file you want to process.</td></tr>
<tr><td><code>--encrypt</code></td><td>Force encryption even if the tool thinks the file is ciphertext.</td></tr>
<tr><td><code>--decrypt</code></td><td>Force decryption (opposite of <code>--encrypt</code>).</td></tr>
<tr><td><code>-q</code>, <code>--quiet</code></td><td>Suppress the â€œfoo â†’ encrypted/decryptedâ€ status line.</td></tr>
</tbody>
</table>

<h2 id="file-format">5.Â File format</h2>

<pre><code>+-------------------- 48Â bytes --------------------+---------+----------+
|  Magic  |Ver|CID|MID|Res|   Nonce   |  Reserved  |Ciphertext|   MAC    |
| "T1FS"  | 1 |01 |01 | 0 | uint64 BE | 32Â Ã—Â 0x00 |   ...    | 32Â B HMAC|
+---------+---+---+---+---+-----------+-----------+----------+----------+
</code></pre>

<ul>
 <li><strong>Magic</strong>Â =Â <code>54&nbsp;31&nbsp;46&nbsp;53</code> (<code>"T1FS"</code>)</li>
 <li><strong>Ver</strong>Â =Â 1</li>
 <li><strong>CID</strong>Â =Â 0x01 (Threefishâ€‘1024 stream)</li>
 <li><strong>MID</strong>Â =Â 0x01 (HMACâ€‘SHAâ€‘256)</li>
 <li><strong>Nonce</strong>Â =Â 64â€‘bit random counter prefix (bigâ€‘endian)</li>
 <li><strong>MAC</strong>Â =Â HMACâ€‘SHAâ€‘256 over header&nbsp;+Â ciphertext</li>
</ul>

<p>The nonce and a monotone 64â€‘bit block counter form the 128â€‘bit tweak input
for each Threefish block, turning it into a counterâ€‘mode stream cipher.</p>

<h2 id="security-notes">6.Â Security notes &amp; caveats</h2>
<ul>
 <li>This build has <em>no KDF</em> or passâ€‘phrase support. You must protect
     <code>key.key</code> with the same care you would give to any raw key material.</li>
 <li>Nonce reuse with the same key <strong>breaks confidentiality</strong>. This
     tool generates a fresh 64â€‘bit nonce every encryption, giving
     2<sup>64</sup> expected security, but do not encrypt in parallel with a
     shared key &amp; external nonces.</li>
 <li>Authenticated encryption is <em>encryptâ€‘thenâ€‘MAC</em>; ciphertext integrity
     is verified <strong>before</strong> decryption to avoid oracle attacks.</li>
 <li>The implementation uses <code>zeroize</code> to wipe key material from
     memory when it goes out of scope, but <em>OSâ€‘level</em> paging or crash
     dumps can still leak data.</li>
 <li>Threefishâ€‘1024 is a mature design from the Skein hashâ€‘function
     submission, but is less reviewed than AES. Evaluate suitability for
     your threat model.</li>
</ul>

<h2 id="development">7.Â Development &amp; testing</h2>

<pre><code># Run unit tests
$ cargo test

# Build a fully static Linux binary (musl)
$ RUSTFLAGS="-C target-feature=+crt-static" \
  cargo build --release --target x86_64-unknown-linux-musl

# Build a fully static Windows binary (GNU toolchain)
$ rustup target add x86_64-pc-windows-gnu
$ set RUSTFLAGS=-C target-feature=+crt-static
$ cargo build --release --target x86_64-pc-windows-gnu
</code></pre>

<p><strong>Crate dependencies</strong> (as of JulyÂ 2025):</p>

<ul>
 <li><code>threefish</code> â€“ pureâ€‘Rust implementation</li>
 <li><code>hmac</code> + <code>sha2</code></li>
 <li><code>clap</code>, <code>anyhow</code>, <code>rand</code>, <code>tempfile</code>, <code>zeroize</code></li>
</ul>

<h2 id="license">8.Â License</h2>
<p>Dualâ€‘licensed under <a href="https://opensource.org/licenses/MIT">MIT</a> or
<a href="https://www.apache.org/licenses/LICENSE-2.0">Apacheâ€‘2.0</a> at your
choice â€” see <code>LICENSE-MIT</code> and <code>LICENSE-APACHE</code>.</p>

<hr>
<p style="font-size:smaller">Â©Â 2025Â ThreefishÂ CLIÂ Authors</p>
</body>
</html>
